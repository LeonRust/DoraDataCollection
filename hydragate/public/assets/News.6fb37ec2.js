var le=Object.defineProperty;var P=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var R=(l,i,s)=>i in l?le(l,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[i]=s,D=(l,i)=>{for(var s in i||(i={}))se.call(i,s)&&R(l,s,i[s]);if(P)for(var s of P(i))ie.call(i,s)&&R(l,s,i[s]);return l};var U=(l,i,s)=>new Promise((b,F)=>{var v=d=>{try{m(s.next(d))}catch(e){F(e)}},p=d=>{try{m(s.throw(d))}catch(e){F(e)}},m=d=>d.done?b(d.value):Promise.resolve(d.value).then(v,p);m((s=s.apply(l,i)).next())});import{T as _e,B as re}from"./TableAction.f556838f.js";import{aF as C,_ as de,d as ce,b as B,v as k,z as pe,u as me,r as f,Z as ge,aw as fe,o as A,c as x,w as n,a as u,j as a,q as w,i as N,as as he,l as r,x as we,y as Fe,N as ve,m as ye,n as Ee,cO as De,a7 as Ce,cP as be,aY as Be,aS as ke,ad as Ae,s as xe,cF as Ne,cG as Te,A as qe}from"./index.86ccf7fc.js";import{P as Se}from"./PlusOutlined.d25dbbc6.js";import{A as ze,_ as Ie,a as Pe}from"./ArchiveOutline.1395acd9.js";import{_ as Re}from"./RadioButton.5933aaea.js";import"./sortable.esm.1502e2e1.js";import"./useDesignSetting.0f98b922.js";import"./propTypes.19b42dfe.js";import"./FormOutlined.17a2d204.js";import"./componentSetting.f3f6bdde.js";import"./index.esm.5448cf00.js";import"./DownOutlined.4c8ebe05.js";function Ue(l){return C.request({url:"/news",method:"GET",params:l})}function $e(l){return C.request({url:"/news/"+l,method:"GET"})}function Oe(l){return C.request({url:"/news",method:"POST",data:l})}function je(l){return C.request({url:"/news/"+l,method:"DELETE"})}const Ge=r(" \u65B0\u5EFA "),Me=r("\u5220\u9664"),Ve=r(" \u786E\u8BA4\u8981\u5220\u9664\u5F53\u524D\u7684\u56FE\u50CF\u5417? "),Je={style:{"margin-bottom":"12px"}},Le=r(" \u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20 "),Ke=r("\u5168\u5E73\u53F0"),Ye=r("\u666E\u901A\u7528\u6237"),Ze=r("\u5546\u5BB6\u7528\u6237"),He=r("\u663E\u793A"),Qe=r("\u9690\u85CF"),We=["id"],Xe={class:"editor-custom-btn-container"},et=r("\u4E0A\u4F20\u6587\u4EF6"),tt=r("\u5173\u95ED"),nt=r("\u4FDD\u5B58"),ut=ce({setup(l){const i=[{title:"id",key:"id",width:50},{title:"\u540D\u79F0",key:"title",width:150},{title:"\u56FE\u50CF",key:"image",width:100,render(t){return t.image.length>0?k(we,{size:48,src:t.image}):"\u65E0"}},{title:"\u662F\u5426\u9690\u85CF",key:"is_hide",width:80,render(t){return k(Fe,{type:t.is_hide?"error":"success"},{default:()=>t.is_hide?"\u9690\u85CF":"\u663E\u793A"})}},{title:"\u987A\u5E8F",key:"news_order",width:80}],s=B({width:140,title:"\u64CD\u4F5C",key:"action",fixed:"right",render(t){return k(_e,{style:"button",actions:[{label:"\u5220\u9664",icon:"ic:outline-delete-outline",onClick:L.bind(null,t),ifShow:()=>!0,auth:["root"]},{label:"\u7F16\u8F91",onClick:J.bind(null,t),ifShow:()=>!0,auth:["root"]}]})}}),b=pe(),F=me(),v=f(),p=f(null),m=f(null),d=f("tinymce-");f(!1);const e=B({activeDrawer:!1,loading:!1,drawerTitle:"News\u7BA1\u7406",id:0,news_type:0,title:null,desc:null,image:null,image_path:null,content:null,is_hide:0,news_order:255}),$={title:{required:!0,trigger:["blur","input"],message:"\u8BF7\u8F93\u5165\u540D\u79F0"},content:{required:!0,trigger:["blur","input"],message:"\u8BF7\u8F93\u5165\u5185\u5BB9"}},O=B({name:"",address:"",date:null}),j=f({pageSize:10}),G=t=>U(this,null,function*(){return yield Ue(D(D(D({},O),j.value),t))}),T=()=>{v.value.reload()},M=()=>{y(),e.activeDrawer=!0,q()},y=()=>{e.activeDrawer=!1,e.loading=!1,e.activeDrawer=!1,e.loading=!1,e.id=0,e.news_type=0,e.title=null,e.desc=null,e.image=null,e.image_path=null,e.content=null,e.is_hide=0,e.news_order=255},V=()=>{var t;y(),(t=p.value)==null||t.destroy(),p.value=null},J=t=>{y(),e.id=t.id,e.news_type=t.news_type,e.title=t.title,e.desc=t.desc,e.image=t.image,e.image_path=t.image_path,e.content=null,e.is_hide=t.is_hide,e.news_order=t.news_order,e.activeDrawer=!0,$e(t.id).then(o=>{e.content=o.content,q()})},L=t=>{b.warning({title:"\u8B66\u544A",content:"\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u6570\u636E\uFF0C\u8BE5\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{je(t.id).then(()=>T())}})},K=({event:t})=>{if(t&&t.target.status==200){const o=JSON.parse(t.target.response);e.image=o.url,e.image_path=o.file_path}},Y=()=>{e.image=null,e.image_path=null},Z=({event:t})=>{var o;if(t&&t.target.status==200){const g=JSON.parse(t.target.response);(o=p.value)==null||o.insertContent(`<img src="${g.url}">`)}},q=()=>{d.value="tinymce-"+(Math.random()*1e4).toFixed(0),ge(()=>{tinymce.init({selector:`#${d.value}`,language:"zh_CN",width:"100%",init_instance_callback:t=>{p.value=t,t.on("NodeChange Change KeyUp SetContent",()=>{e.content=t.getContent()})}})})},H=t=>{var o;t.preventDefault(),(o=m.value)==null||o.validate(g=>{if(g)F.error("\u9A8C\u8BC1\u5931\u8D25");else{const E={id:e.id,news_type:e.news_type,title:e.title,desc:e.desc,image:e.image_path,content:e.content,is_hide:e.is_hide,news_order:e.news_order};e.loading=!0,Oe(E).then(()=>{y(),T()}).finally(()=>{e.loading=!1})}})};return fe(()=>{}),(t,o)=>{const g=ve,E=ye,c=Ee,Q=De,W=Ie,S=Ce,X=Pe,ee=be,z=Be,h=Re,I=ke,te=Ae,ne=xe,ue=Ne,ae=Te,oe=qe;return A(),x(oe,{bordered:!1,class:"proCard"},{default:n(()=>[u(a(re),{columns:i,request:G,"row-key":_=>_.id,ref_key:"actionRef",ref:v,actionColumn:a(s),"scroll-x":1090},{tableTitle:n(()=>[u(a(w),{type:"primary",onClick:M},{icon:n(()=>[u(g,null,{default:n(()=>[u(a(Se))]),_:1})]),default:n(()=>[Ge]),_:1})]),_:1},8,["row-key","actionColumn"]),u(ae,{show:a(e).activeDrawer,"onUpdate:show":o[5]||(o[5]=_=>a(e).activeDrawer=_),width:"100%","close-on-esc":!1,"mask-closable":!1,"z-index":1e3},{default:n(()=>[u(ue,{title:a(e).drawerTitle},{footer:n(()=>[u(S,null,{default:n(()=>[u(a(w),{onClick:V},{default:n(()=>[tt]),_:1}),u(a(w),{type:"info",loading:a(e).loading,onClick:H},{default:n(()=>[nt]),_:1},8,["loading"])]),_:1})]),default:n(()=>[u(ne,{ref_key:"formRef",ref:m,model:a(e),"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",rules:$},{default:n(()=>[u(c,{label:"\u540D\u79F0",path:"title"},{default:n(()=>[u(E,{value:a(e).title,"onUpdate:value":o[0]||(o[0]=_=>a(e).title=_),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["value"])]),_:1}),u(c,{label:"\u7F29\u7565\u56FE",path:"image"},{default:n(()=>[a(e).image&&a(e).image_path?(A(),x(S,{key:0,vertical:""},{default:n(()=>[u(Q,{src:a(e).image,width:"100"},null,8,["src"]),u(W,{"show-icon":!1,onPositiveClick:Y},{trigger:n(()=>[u(a(w),null,{default:n(()=>[Me]),_:1})]),default:n(()=>[Ve]),_:1})]),_:1})):(A(),x(z,{key:1,"directory-dnd":"",action:"/api/admin/upload",accept:"image/png, image/jpeg",name:"image",onFinish:K},{default:n(()=>[u(ee,null,{default:n(()=>[N("div",Je,[u(g,{size:"48",depth:3},{default:n(()=>[u(a(ze))]),_:1})]),u(X,{style:{"font-size":"16px"}},{default:n(()=>[Le]),_:1})]),_:1})]),_:1}))]),_:1}),u(c,{label:"\u8BF4\u660E",path:"desc"},{default:n(()=>[u(E,{type:"textarea",value:a(e).desc,"onUpdate:value":o[1]||(o[1]=_=>a(e).desc=_),placeholder:"\u8BF7\u8F93\u5165\u8BF4\u660E"},null,8,["value"])]),_:1}),u(c,{label:"\u76EE\u6807\u7528\u6237"},{default:n(()=>[u(I,{value:a(e).news_type,"onUpdate:value":o[2]||(o[2]=_=>a(e).news_type=_)},{default:n(()=>[u(h,{value:0},{default:n(()=>[Ke]),_:1}),u(h,{value:1},{default:n(()=>[Ye]),_:1}),u(h,{value:2},{default:n(()=>[Ze]),_:1})]),_:1},8,["value"])]),_:1}),u(c,{label:"\u662F\u5426\u9690\u85CF"},{default:n(()=>[u(I,{value:a(e).is_hide,"onUpdate:value":o[3]||(o[3]=_=>a(e).is_hide=_)},{default:n(()=>[u(h,{value:0},{default:n(()=>[He]),_:1}),u(h,{value:1},{default:n(()=>[Qe]),_:1})]),_:1},8,["value"])]),_:1}),u(c,{label:"\u987A\u5E8F"},{default:n(()=>[u(te,{value:a(e).news_order,"onUpdate:value":o[4]||(o[4]=_=>a(e).news_order=_),min:1,max:65535},null,8,["value"])]),_:1}),u(c,{label:"\u5185\u5BB9",path:"content"},{default:n(()=>[N("textarea",{id:d.value},he(a(e).content),9,We),N("div",Xe,[u(z,{action:"/api/admin/upload",accept:"image/png, image/jpeg",name:"image","show-file-list":!1,onFinish:Z},{default:n(()=>[u(a(w),null,{default:n(()=>[et]),_:1})]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])]),_:1})}}});var ht=de(ut,[["__scopeId","data-v-11397ae8"]]);export{ht as default};
