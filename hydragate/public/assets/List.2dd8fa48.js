var hu=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var yu=Object.prototype.hasOwnProperty,vu=Object.prototype.propertyIsEnumerable;var G=(m,g,i)=>g in m?hu(m,g,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[g]=i,B=(m,g)=>{for(var i in g||(g={}))yu.call(g,i)&&G(m,i,g[i]);if(Y)for(var i of Y(g))vu.call(g,i)&&G(m,i,g[i]);return m};var P=(m,g,i)=>new Promise((I,b)=>{var x=c=>{try{v(i.next(c))}catch(u){b(u)}},N=c=>{try{v(i.throw(c))}catch(u){b(u)}},v=c=>c.done?I(c.value):Promise.resolve(c.value).then(x,N);v((i=i.apply(m,g)).next())});import{v as H,x as Eu,d as Du,r as k,u as bu,z as Au,b as w,bT as Cu,o as d,c as f,w as t,a,j as o,at as A,i as R,h as O,aA as j,aD as L,l as p,N as ku,q as wu,m as Iu,n as xu,aS as Nu,cN as Uu,a7 as Su,cO as Tu,aY as qu,ae as $u,aa as zu,ad as Pu,df as Ru,s as Ou,cE as ju,cF as Lu,A as Vu,as as Ju,a6 as Mu,dg as Yu}from"./index.3790d147.js";import{g as Gu,d as Hu,a as Ku,b as Qu,p as Wu}from"./index.0f2f2e16.js";import{T as Xu,B as Zu}from"./TableAction.4151f0b4.js";import{P as ue}from"./PlusOutlined.71de4daf.js";import{A as V,_ as ee,a as te}from"./ArchiveOutline.24497a89.js";import{_ as ae}from"./RadioButton.222114b3.js";import"./sortable.esm.1502e2e1.js";import"./useDesignSetting.e02d28c9.js";import"./propTypes.15d30787.js";import"./FormOutlined.88898c98.js";import"./componentSetting.f3f6bdde.js";import"./index.esm.ed31f38f.js";import"./DownOutlined.25d3f8ea.js";const ne=[{title:"id",key:"id",width:50},{title:"\u540D\u79F0",key:"name",width:180},{title:"\u987A\u5E8F",key:"store_order",width:80},{title:"\u72B6\u6001",key:"is_normal",width:100,render(m){return m.is_normal==1?"\u5DF2\u5BA1\u6838":m.is_normal==2?"\u5DF2\u62D2\u7EDD":"\u5F85\u5BA1\u6838"}},{title:"\u56FE\u50CF",key:"avatar",width:100,render(m){return H(Eu,{size:48,src:m.image})}},{title:"\u5730\u5740",key:"address",width:240},{title:"\u521B\u5EFA\u65F6\u95F4",key:"created_at",width:160}],oe=p(" \u65B0\u5EFA "),le=p("\u5F85\u5BA1\u6838"),se=p("\u5DF2\u5BA1\u6838"),ie=p("\u5DF2\u62D2\u7EDD"),_e=p("\u5220\u9664"),re=p(" \u786E\u8BA4\u8981\u5220\u9664\u5F53\u524D\u7684\u56FE\u50CF\u5417? "),ce={style:{"margin-bottom":"12px"}},de=p(" \u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20 "),pe=p("\u5220\u9664"),me=p(" \u786E\u8BA4\u8981\u5220\u9664\u5F53\u524D\u7684\u56FE\u50CF\u5417? "),ge={style:{"margin-bottom":"12px"}},fe=p(" \u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20 "),Fe=p("\u5220\u9664"),Be=p(" \u786E\u8BA4\u8981\u5220\u9664\u5F53\u524D\u7684\u56FE\u50CF\u5417? "),he={style:{"margin-bottom":"12px"}},ye=p(" \u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20 "),ve=p("\u5173\u95ED"),Ee=p("\u4FDD\u5B58"),ze=Du({setup(m){const g=k(null),i=bu(),I=Au(),b=k(),x=w({name:"",address:"",date:null}),N=k({page:1,pageSize:10}),v=k(!1),c=w({store_types:[],system_types:[],tags:[],accounts:[]}),u=w({activeDrawer:!1,title:"\u6DFB\u52A0\u5546\u5BB6",loading:!1,id:0,name:null,is_normal:1,image:null,image_path:null,longitude:null,latitude:null,address:null,type_id:null,store_type_id:null,store_order:255,tags:[],accountUploadImageIndex:0,accounts:[],username:"",mobile:"",content:"",storeImages:[]}),K={name:{required:!0,trigger:["blur","input"],message:"\u8BF7\u8F93\u5165\u5546\u5BB6\u540D\u79F0"},is_normal:{type:"number",required:!0,trigger:"change",message:"\u8BF7\u9009\u62E9\u5546\u5BB6\u72B6\u6001"},image:{required:!0,trigger:"change",message:"\u8BF7\u4E0A\u4F20\u5546\u5BB6\u56FE\u7247"},address:{required:!0,trigger:["blur","input"],message:"\u8BF7\u8F93\u5165\u5546\u5BB6\u5730\u5740"},type_id:{type:"number",required:!0,trigger:"change",message:"\u8BF7\u9009\u62E9\u9996\u9875\u83DC\u5355"},store_type_id:{type:"number",required:!0,trigger:"change",message:"\u8BF7\u9009\u62E9\u5546\u5BB6\u6240\u5C5E\u5206\u7C7B"},tags:{type:"array",required:!0,trigger:"change",message:"\u8BF7\u9009\u62E9\u5546\u5BB6\u6807\u7B7E"}},Q=w({width:140,title:"\u64CD\u4F5C",key:"action",fixed:"right",render(n){return H(Xu,{style:"button",actions:[{label:"\u5220\u9664",icon:"ic:outline-delete-outline",onClick:eu.bind(null,n),ifShow:()=>!0,auth:["root"]},{label:"\u7F16\u8F91",onClick:uu.bind(null,n),ifShow:()=>!0,auth:["root"]}]})}}),W=n=>P(this,null,function*(){return yield Qu(B(B(B({},x),N.value),n))});function X(){U(),u.activeDrawer=!0}function Z(){U()}function U(){u.activeDrawer=!1,u.title="\u6DFB\u52A0\u5546\u5BB6",u.loading=!1,u.id=0,u.name=null,u.is_normal=1,u.image=null,u.image_path=null,u.longitude=null,u.latitude=null,u.address=null,u.type_id=null,u.store_type_id=null,u.store_order=255,u.tags=[],u.accountUploadImageIndex=0,u.accounts=c.accounts.map(n=>B({},n)),u.username="",u.mobile="",u.content="",u.storeImages=[]}function J(){b.value.reload()}function uu(n){var e,r,F;u.title="\u7F16\u8F91: "+n.name,u.id=n.id,u.name=n.name,u.is_normal=n.is_normal,u.image=n.image,u.image_path=n.image_path,u.longitude=null,u.latitude=null,u.address=n.address,u.type_id=n.type_id==null||n.type_id===0?null:n.type_id,u.store_type_id=n.store_type_id==null||n.store_type_id===0?null:n.store_type_id,u.store_order=n.store_order,u.tags=n.tag_ids.concat(n.tag_sys_ids),u.accountUploadImageIndex=0,u.accounts=c.accounts.map(_=>(n.accounts.forEach(s=>{s.account_type_id==_.id&&(_.account_value=s.account_value,_.account_image=s.account_image,_.account_image_path=s.account_image_path,_.account_type_id=s.account_type_id)}),_)),u.username=(e=n.username)!=null?e:"",u.mobile=(r=n.mobile)!=null?r:"",u.content=(F=n.content)!=null?F:"",u.activeDrawer=!0,Gu(n.id).then(_=>{u.storeImages=_})}function eu(n){I.warning({title:"\u8B66\u544A",content:"\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u5546\u5BB6\uFF0C\u8BE5\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{Hu(n.id).then(()=>J())}})}function tu({file:n,event:e}){if(e&&e.target.status==200){const r=JSON.parse(e.target.response);u.image=r.url,u.image_path=r.file_path}}function au(){u.image=null,u.image_path=null}function nu({file:n,event:e}){if(e&&e.target.status==200){const r=JSON.parse(e.target.response);u.storeImages.push({image:r.url,image_path:r.file_path})}}function ou(n){u.storeImages.splice(n,1)}function lu(n){return u.accountUploadImageIndex=~~n,!0}function su({file:n,event:e}){if(e&&e.target.status==200){const r=JSON.parse(e.target.response);u.accounts[u.accountUploadImageIndex].account_image=r.url,u.accounts[u.accountUploadImageIndex].account_image_path=r.file_path}}function iu(n){u.accounts[n].account_image=null,u.accounts[n].account_image_path=null}function _u(n){var e;n.preventDefault(),(e=g.value)==null||e.validate(r=>{var F,_;if(r)i.error("\u9A8C\u8BC1\u5931\u8D25");else{const s=parseFloat((F=u.longitude)!=null?F:""),E=parseFloat((_=u.latitude)!=null?_:"");if(u.id==0){if(u.longitude==null||u.latitude==null)return i.error("\u8BF7\u8F93\u5165\u7ECF\u7EAC\u5EA6");if(isNaN(s)||isNaN(E))return i.error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u7ECF\u7EAC\u5EA6")}else if(!(u.longitude==null&&u.latitude==null))return isNaN(s)||isNaN(E)?i.error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u7ECF\u7EAC\u5EA6"):i.error("\u7ECF\u7EAC\u5EA6\u5FC5\u987B\u540C\u65F6\u8F93\u5165");const S={id:u.id,is_normal:u.is_normal,name:u.name,image:u.image_path,address:u.address,longitude:isNaN(s)?null:s,latitude:isNaN(E)?null:E,type_id:u.type_id,store_type_id:u.store_type_id,store_order:u.store_order,tags:u.tags,account:u.accounts.map(h=>{var D,y;return{account_type_id:h.account_type_id,account_value:(D=h.account_value)!=null?D:"",account_image:(y=h.account_image_path)!=null?y:""}}),username:u.username,mobile:u.mobile,content:u.content,images:u.storeImages.map(h=>h.image_path)};u.loading=!0,Wu(S).then(()=>{U(),J()}).finally(()=>{u.loading=!1})}})}return Cu(()=>P(this,null,function*(){v.value=!1;const n=yield Ku();c.store_types=n.store_types.filter(e=>!e.is_hide).map(e=>B({label:e.is_only_sys?e.name+" (\u5E73\u53F0)":e.name,value:e.id},e)),c.system_types=n.system_type.map(e=>B({label:e.name,value:e.id},e)),c.tags=n.tags.filter(e=>!e.is_hide).map(e=>B({label:e.is_sys?e.name+" (\u5E73\u53F0)":e.name,value:e.id},e)),c.accounts=n.accounts.map(e=>B({account_type_id:e.id,account_value:null,account_image:null,account_image_path:null},e)),u.accounts=n.accounts.map(e=>B({account_type_id:e.id,account_value:null,account_image:null,account_image_path:null},e)),v.value=!0})),(n,e)=>{const r=ku,F=wu,_=Iu,s=xu,E=ae,S=Nu,h=Uu,D=ee,y=Su,T=te,q=Tu,$=qu,M=$u,ru=Mu,cu=zu,du=Pu,pu=Yu,mu=Ru,gu=Ou,fu=ju,Fu=Lu,Bu=Vu;return d(),f(Bu,{bordered:!1,class:"proCard"},{default:t(()=>[a(o(Zu),{columns:o(ne),request:W,"row-key":l=>l.id,ref_key:"actionRef",ref:b,actionColumn:o(Q),"scroll-x":1090},{tableTitle:t(()=>[v.value?(d(),f(F,{key:0,type:"primary",onClick:X},{icon:t(()=>[a(r,null,{default:t(()=>[a(o(ue))]),_:1})]),default:t(()=>[oe]),_:1})):A("",!0)]),_:1},8,["columns","row-key","actionColumn"]),v.value?(d(),f(Fu,{key:0,show:o(u).activeDrawer,"onUpdate:show":e[11]||(e[11]=l=>o(u).activeDrawer=l),width:"60%","close-on-esc":!1,"mask-closable":!1},{default:t(()=>[a(fu,{title:o(u).title},{footer:t(()=>[a(y,null,{default:t(()=>[a(F,{onClick:Z},{default:t(()=>[ve]),_:1}),a(F,{type:"info",loading:o(u).loading,onClick:_u},{default:t(()=>[Ee]),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(gu,{ref_key:"formRef",ref:g,model:o(u),"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",rules:K},{default:t(()=>[a(s,{label:"\u5546\u5BB6\u540D\u79F0",path:"name"},{default:t(()=>[a(_,{value:o(u).name,"onUpdate:value":e[0]||(e[0]=l=>o(u).name=l),placeholder:"\u8BF7\u8F93\u5165\u5546\u5BB6\u540D\u79F0"},null,8,["value"])]),_:1}),a(s,{label:"\u5546\u5BB6\u72B6\u6001",path:"is_normal"},{default:t(()=>[a(S,{value:o(u).is_normal,"onUpdate:value":e[1]||(e[1]=l=>o(u).is_normal=l)},{default:t(()=>[a(E,{value:0},{default:t(()=>[le]),_:1}),a(E,{value:1},{default:t(()=>[se]),_:1}),a(E,{value:2},{default:t(()=>[ie]),_:1})]),_:1},8,["value"])]),_:1}),a(s,{label:"\u5546\u5BB6\u56FE\u7247",path:"image"},{default:t(()=>[o(u).image&&o(u).image_path?(d(),f(y,{key:0,vertical:""},{default:t(()=>[a(h,{src:o(u).image,width:"100"},null,8,["src"]),a(D,{"show-icon":!1,onPositiveClick:au},{trigger:t(()=>[a(F,null,{default:t(()=>[_e]),_:1})]),default:t(()=>[re]),_:1})]),_:1})):(d(),f($,{key:1,"directory-dnd":"",action:"/api/admin/upload",accept:"image/png, image/jpeg",name:"image",onFinish:tu},{default:t(()=>[a(q,null,{default:t(()=>[R("div",ce,[a(r,{size:"48",depth:3},{default:t(()=>[a(o(V))]),_:1})]),a(T,{style:{"font-size":"16px"}},{default:t(()=>[de]),_:1})]),_:1})]),_:1}))]),_:1}),a(s,{label:"\u5546\u5BB6\u5730\u5740",path:"address"},{default:t(()=>[a(_,{value:o(u).address,"onUpdate:value":e[2]||(e[2]=l=>o(u).address=l),placeholder:"\u8BF7\u8F93\u5165\u5546\u5BB6\u5730\u5740"},null,8,["value"])]),_:1}),a(s,{label:"\u59D3\u540D",path:"username"},{default:t(()=>[a(_,{value:o(u).username,"onUpdate:value":e[3]||(e[3]=l=>o(u).username=l),placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D"},null,8,["value"])]),_:1}),a(s,{label:"\u624B\u673A\u53F7",path:"mobile"},{default:t(()=>[a(_,{value:o(u).mobile,"onUpdate:value":e[4]||(e[4]=l=>o(u).mobile=l),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["value"])]),_:1}),a(s,{label:"\u5730\u5740\u7ECF\u5EA6",path:"longitude"},{default:t(()=>[a(_,{value:o(u).longitude,"onUpdate:value":e[5]||(e[5]=l=>o(u).longitude=l),placeholder:"\u8BF7\u8F93\u5165\u5730\u5740\u7ECF\u5EA6\u3002\u65B0\u6DFB\u52A0\u7684\u5546\u5BB6\u5FC5\u987B\u8F93\u5165\uFF0C\u4FEE\u6539\u5546\u5BB6\u7559\u7A7A\u4FDD\u6301\u4E0D\u53D8"},null,8,["value"])]),_:1}),a(s,{label:"\u5730\u5740\u7EAC\u5EA6",path:"latitude"},{default:t(()=>[a(_,{value:o(u).latitude,"onUpdate:value":e[6]||(e[6]=l=>o(u).latitude=l),placeholder:"\u8BF7\u8F93\u5165\u5730\u5740\u7EAC\u5EA6\u3002\u65B0\u6DFB\u52A0\u7684\u5546\u5BB6\u5FC5\u987B\u8F93\u5165\uFF0C\u4FEE\u6539\u5546\u5BB6\u7559\u7A7A\u4FDD\u6301\u4E0D\u53D8"},null,8,["value"])]),_:1}),a(s,{label:"\u9996\u9875\u83DC\u5355",path:"type_id"},{default:t(()=>[a(M,{value:o(u).type_id,"onUpdate:value":e[7]||(e[7]=l=>o(u).type_id=l),placeholder:"\u8BF7\u9009\u62E9\u9996\u9875\u83DC\u5355",options:o(c).system_types},null,8,["value","options"])]),_:1}),a(s,{label:"\u5546\u5BB6\u5206\u7C7B",path:"store_type_id"},{default:t(()=>[a(M,{value:o(u).store_type_id,"onUpdate:value":e[8]||(e[8]=l=>o(u).store_type_id=l),placeholder:"\u8BF7\u9009\u62E9\u5546\u5BB6\u6240\u5C5E\u5206\u7C7B",options:o(c).store_types},null,8,["value","options"])]),_:1}),a(s,{label:"\u5546\u5BB6\u6807\u7B7E",path:"tags"},{default:t(()=>[a(cu,{value:o(u).tags,"onUpdate:value":e[9]||(e[9]=l=>o(u).tags=l)},{default:t(()=>[a(y,null,{default:t(()=>[(d(!0),O(L,null,j(o(c).tags,l=>(d(),f(ru,{key:"tag",value:l.value},{default:t(()=>[p(Ju(l.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),a(s,{label:"\u987A\u5E8F",path:"store_order"},{default:t(()=>[a(du,{value:o(u).store_order,"onUpdate:value":e[10]||(e[10]=l=>o(u).store_order=l),min:1,max:65535},null,8,["value"])]),_:1}),a(s,{label:"\u5546\u5BB6\u6B63\u6587\u56FE\u7247"},{default:t(()=>[a(y,null,{default:t(()=>[(d(!0),O(L,null,j(o(u).storeImages,(l,C)=>(d(),f(y,{key:"storeImage",vertical:""},{default:t(()=>[a(h,{src:l.image,width:"100"},null,8,["src"]),a(D,{"show-icon":!1,onPositiveClick:z=>ou(C)},{trigger:t(()=>[a(F,null,{default:t(()=>[pe]),_:1})]),default:t(()=>[me]),_:2},1032,["onPositiveClick"])]),_:2},1024))),128)),o(u).storeImages.length<9?(d(),f($,{key:0,"directory-dnd":"",action:"/api/admin/upload",accept:"image/png, image/jpeg",name:"image",onFinish:nu},{default:t(()=>[a(q,null,{default:t(()=>[R("div",ge,[a(r,{size:"48",depth:3},{default:t(()=>[a(o(V))]),_:1})]),a(T,{style:{"font-size":"16px"}},{default:t(()=>[fe]),_:1})]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1}),a(s,{label:"\u8D26\u53F7"},{default:t(()=>[a(mu,{type:"line",animated:"",onBeforeLeave:lu},{default:t(()=>[(d(!0),O(L,null,j(o(u).accounts,(l,C)=>(d(),f(pu,{key:"account",name:C+"",tab:l.name},{default:t(()=>[l.show_account?(d(),f(s,{key:0,label:"\u8D26\u53F7"},{default:t(()=>[a(_,{value:l.account_value,"onUpdate:value":z=>l.account_value=z,placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7"},null,8,["value","onUpdate:value"])]),_:2},1024)):A("",!0),l.show_image?(d(),f(s,{key:1,label:"\u56FE\u50CF"},{default:t(()=>[l.account_image&&l.account_image_path?(d(),f(y,{key:0,vertical:""},{default:t(()=>[a(h,{src:l.account_image,width:"100"},null,8,["src"]),a(D,{"show-icon":!1,onPositiveClick:z=>iu(C)},{trigger:t(()=>[a(F,null,{default:t(()=>[Fe]),_:1})]),default:t(()=>[Be]),_:2},1032,["onPositiveClick"])]),_:2},1024)):(d(),f($,{key:1,"directory-dnd":"",action:"/api/admin/upload",accept:"image/png, image/jpeg",name:"image",onFinish:su},{default:t(()=>[a(q,null,{default:t(()=>[R("div",he,[a(r,{size:"48",depth:3},{default:t(()=>[a(o(V))]),_:1})]),a(T,{style:{"font-size":"16px"}},{default:t(()=>[ye]),_:1})]),_:1})]),_:1}))]),_:2},1024)):A("",!0)]),_:2},1032,["name","tab"]))),128))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])):A("",!0)]),_:1})}}});export{ze as default};
