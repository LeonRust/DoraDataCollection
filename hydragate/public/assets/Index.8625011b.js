var ne=Object.defineProperty;var z=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var R=(s,l,i)=>l in s?ne(s,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[l]=i,B=(s,l)=>{for(var i in l||(l={}))ue.call(l,i)&&R(s,i,l[i]);if(z)for(var i of z(l))oe.call(l,i)&&R(s,i,l[i]);return s};var P=(s,l,i)=>new Promise((C,F)=>{var D=e=>{try{c(i.next(e))}catch(g){F(g)}},v=e=>{try{c(i.throw(e))}catch(g){F(g)}},c=e=>e.done?C(e.value):Promise.resolve(e.value).then(D,v);c((i=i.apply(s,l)).next())});import{T as ie,B as le}from"./TableAction.4151f0b4.js";import{g as se,d as re,a as _e,p as me}from"./information.dc901e97.js";import{P as ce}from"./PlusOutlined.71de4daf.js";import{A as q,_ as de,a as pe}from"./ArchiveOutline.24497a89.js";import{d as ge,b as S,v as $,z as fe,u as he,r as k,o as p,c as f,w as t,a,j as u,q as h,i as O,h as Fe,aA as De,aD as ve,at as we,l as _,x as Ee,N as ke,m as Ce,n as ye,cN as Be,a7 as be,cO as Ae,aY as xe,ad as Ie,s as Te,cE as Ne,cF as ze,A as Re}from"./index.3790d147.js";import"./sortable.esm.1502e2e1.js";import"./useDesignSetting.e02d28c9.js";import"./propTypes.15d30787.js";import"./FormOutlined.88898c98.js";import"./componentSetting.f3f6bdde.js";import"./index.esm.ed31f38f.js";import"./DownOutlined.25d3f8ea.js";const Pe=_(" \u65B0\u5EFA "),qe=_("\u5220\u9664"),Se=_(" \u786E\u8BA4\u8981\u5220\u9664\u5F53\u524D\u7684\u56FE\u50CF\u5417? "),$e={style:{"margin-bottom":"12px"}},Oe=_(" \u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20 "),Ve=_("\u5220\u9664"),je=_(" \u786E\u8BA4\u8981\u5220\u9664\u5F53\u524D\u7684\u56FE\u50CF\u5417? "),Ue={style:{"margin-bottom":"12px"}},Je=_(" \u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20 "),Le=_("\u5173\u95ED"),Me=_("\u4FDD\u5B58"),it=ge({setup(s){const l=[{title:"id",key:"id",width:50},{title:"\u540D\u79F0",key:"name",width:150},{title:"\u56FE\u50CF",key:"image",width:100,render(n){return n.image.length>0?$(Ee,{size:48,src:n.image}):"\u65E0"}},{title:"\u987A\u5E8F",key:"order",width:80}],i=S({width:140,title:"\u64CD\u4F5C",key:"action",fixed:"right",render(n){return $(ie,{style:"button",actions:[{label:"\u5220\u9664",icon:"ic:outline-delete-outline",onClick:M.bind(null,n),ifShow:()=>!0,auth:["root"]},{label:"\u7F16\u8F91",onClick:L.bind(null,n),ifShow:()=>!0,auth:["root"]}]})}}),C=fe(),F=he(),D=k(),v=k(null),c=k(null),e=S({activeDrawer:!1,loading:!1,drawerTitle:"\u6DFB\u52A0/\u7F16\u8F91\u4FE1\u606F",id:0,name:null,image:null,image_path:null,order:255,images:[]}),g={name:{required:!0,trigger:["blur","input"],message:"\u8BF7\u8F93\u5165\u540D\u79F0"},image:{required:!0,trigger:"change",message:"\u8BF7\u4E0A\u4F20\u56FE\u7247"}},V=k({pageSize:10}),j=n=>P(this,null,function*(){return yield _e(B(B({},V.value),n))}),b=()=>{D.value.reload()},U=()=>{w(),e.activeDrawer=!0},w=()=>{e.activeDrawer=!1,e.loading=!1,e.activeDrawer=!1,e.loading=!1,e.id=0,e.name=null,e.image=null,e.image_path=null,e.order=255,e.images=[]},J=()=>{var n;w(),(n=v.value)==null||n.destroy(),v.value=null},L=n=>{w(),e.id=n.id,e.name=n.name,e.image=n.image,e.image_path=n.image_path,e.order=n.order,e.activeDrawer=!0,se(n.id).then(o=>{e.images=o})},M=n=>{C.warning({title:"\u8B66\u544A",content:"\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u6570\u636E\uFF0C\u8BE5\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{re(n.id).then(()=>b())}})},Y=({event:n})=>{if(n&&n.target.status==200){const o=JSON.parse(n.target.response);e.image=o.url,e.image_path=o.file_path}},G=()=>{e.image=null,e.image_path=null};function H({file:n,event:o}){if(o&&o.target.status==200){const m=JSON.parse(o.target.response);e.images.push({image:m.url,image_path:m.file_path})}}function K(n){e.images.splice(n,1)}const Q=n=>{var o;n.preventDefault(),(o=c.value)==null||o.validate(m=>{if(m)F.error("\u9A8C\u8BC1\u5931\u8D25");else{const y={id:e.id,name:e.name,image:e.image_path,order:e.order,images:e.images.map(d=>d.image_path)};e.loading=!0,me(y).then(()=>{w(),b()}).finally(()=>{e.loading=!1})}})};return(n,o)=>{const m=ke,y=Ce,d=ye,A=Be,x=de,E=be,I=pe,T=Ae,N=xe,W=Ie,X=Te,Z=Ne,ee=ze,te=Re;return p(),f(te,{bordered:!1,class:"proCard"},{default:t(()=>[a(u(le),{columns:l,request:j,"row-key":r=>r.id,ref_key:"actionRef",ref:D,actionColumn:u(i),"scroll-x":1090},{tableTitle:t(()=>[a(u(h),{type:"primary",onClick:U},{icon:t(()=>[a(m,null,{default:t(()=>[a(u(ce))]),_:1})]),default:t(()=>[Pe]),_:1})]),_:1},8,["row-key","actionColumn"]),a(ee,{show:u(e).activeDrawer,"onUpdate:show":o[2]||(o[2]=r=>u(e).activeDrawer=r),width:"50%","close-on-esc":!1,"mask-closable":!1,"z-index":1e3},{default:t(()=>[a(Z,{title:u(e).drawerTitle},{footer:t(()=>[a(E,null,{default:t(()=>[a(u(h),{onClick:J},{default:t(()=>[Le]),_:1}),a(u(h),{type:"info",loading:u(e).loading,onClick:Q},{default:t(()=>[Me]),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(X,{ref_key:"formRef",ref:c,model:u(e),"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",rules:g},{default:t(()=>[a(d,{label:"\u540D\u79F0",path:"name"},{default:t(()=>[a(y,{value:u(e).name,"onUpdate:value":o[0]||(o[0]=r=>u(e).name=r),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["value"])]),_:1}),a(d,{label:"\u7F29\u7565\u56FE",path:"image"},{default:t(()=>[u(e).image&&u(e).image_path?(p(),f(E,{key:0,vertical:""},{default:t(()=>[a(A,{src:u(e).image,width:"100"},null,8,["src"]),a(x,{"show-icon":!1,onPositiveClick:G},{trigger:t(()=>[a(u(h),null,{default:t(()=>[qe]),_:1})]),default:t(()=>[Se]),_:1})]),_:1})):(p(),f(N,{key:1,"directory-dnd":"",action:"/api/admin/upload",accept:"image/png, image/jpeg",name:"image",onFinish:Y},{default:t(()=>[a(T,null,{default:t(()=>[O("div",$e,[a(m,{size:"48",depth:3},{default:t(()=>[a(u(q))]),_:1})]),a(I,{style:{"font-size":"16px"}},{default:t(()=>[Oe]),_:1})]),_:1})]),_:1}))]),_:1}),a(d,{label:"\u987A\u5E8F"},{default:t(()=>[a(W,{value:u(e).order,"onUpdate:value":o[1]||(o[1]=r=>u(e).order=r),min:1,max:65535},null,8,["value"])]),_:1}),a(d,{label:"\u6B63\u6587\u56FE\u7247"},{default:t(()=>[a(E,null,{default:t(()=>[(p(!0),Fe(ve,null,De(u(e).images,(r,ae)=>(p(),f(E,{key:"formImage",vertical:""},{default:t(()=>[a(A,{src:r.image,width:"100"},null,8,["src"]),a(x,{"show-icon":!1,onPositiveClick:Ye=>K(ae)},{trigger:t(()=>[a(u(h),null,{default:t(()=>[Ve]),_:1})]),default:t(()=>[je]),_:2},1032,["onPositiveClick"])]),_:2},1024))),128)),u(e).images.length<9?(p(),f(N,{key:0,"directory-dnd":"",action:"/api/admin/upload",accept:"image/png, image/jpeg",name:"image",onFinish:H},{default:t(()=>[a(T,null,{default:t(()=>[O("div",Ue,[a(m,{size:"48",depth:3},{default:t(()=>[a(u(q))]),_:1})]),a(I,{style:{"font-size":"16px"}},{default:t(()=>[Je]),_:1})]),_:1})]),_:1})):we("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])]),_:1})}}});export{it as default};
